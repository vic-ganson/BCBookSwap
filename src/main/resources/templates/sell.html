<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sell a Book | BC BookSwap</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', sans-serif; background-color: #f5f6fa; color: #222; display: flex; height: 100vh; }
    .layout { display: flex; width: 100%; }

    /* SIDEBAR */
    .sidebar {
      width: 220px;
      background: linear-gradient(180deg, #8b0000, #a83232);
      color: white;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .sidebar .logo {
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 3rem;
      line-height: 1.2;
    }

    .sidebar nav {
      display: flex;
      flex-direction: column;
      width: 100%;
      gap: 1rem;
    }

    .sidebar nav a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 0.75rem 1rem;
      border-radius: 10px;
      transition: background 0.3s ease;
    }

    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: rgba(255, 255, 255, 0.2);
    }

    /* MAIN CONTENT */
    .main-content { flex: 1; padding: 2rem; overflow-y: auto; }
    header h1 { color: #8b0000; margin-bottom: 0.3rem; }
    header p { color: #444; margin-bottom: 2rem; }

    /* FORM */
    form {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    label {
      font-weight: 600;
      margin-bottom: 0.4rem;
      display: block;
      color: #8b0000;
    }

    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 0.9rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 1rem;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease;
      font-family: 'Inter', sans-serif;
      color: #222;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #8b0000;
      box-shadow: 0 0 5px rgba(139,0,0,0.3);
    }

    textarea { resize: vertical; min-height: 100px; }

    button {
      background: #8b0000;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 0.9rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    button:hover { background: #a83232; transform: translateY(-2px); }

    footer {
      text-align: center;
      margin-top: 3rem;
      color: #777;
      font-size: 0.9rem;
    }

    /* POPUP */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      animation: fadeIn 0.3s ease;
    }

    .popup h2 { color: #8b0000; margin-bottom: 1rem; }
    .popup p { margin-bottom: 1.5rem; }
    .popup button {
      background: #8b0000;
      color: #fff;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    @media (max-width: 800px) {
      .layout { flex-direction: column; }
      .sidebar { flex-direction: row; width: 100%; border-radius: 0; justify-content: space-around; padding: 1rem; }
      .sidebar nav { flex-direction: row; gap: 0.5rem; }
      form { width: 90%; }
    }
  </style>
</head>

<body>
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="logo">BC<br>Exchange</div>
      <nav>
        <a href="/index">Home</a>
        <a href="/sell" class="active">Sell a Book</a>
        <a href="/account">My Profile</a>
      </nav>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <header>
        <h1>Sell a Book</h1>
        <p>Fill out the form below to list your book for sale.</p>
      </header>

      <form id="sellForm">
        <div>
          <label for="title">Book Title</label>
          <input type="text" id="title" name="title" placeholder="e.g., Â¡ANDA!" required>
        </div>

        <div>
          <label for="author">Author</label>
          <input type="text" id="author" name="author" placeholder="e.g., James, LeBron" required>
        </div>

        <div>
          <label for="isbn">ISBN</label>
          <input type="text" id="isbn" name="isbn" placeholder="e.g., 978-0-306-40615-7" required>
        </div>

        <div>
          <label for="course">Course Name</label>
          <input type="text" id="course" name="course" placeholder="e.g., Elementary Spanish I" required>
        </div>

        <div>
          <label for="condition">Condition</label>
          <select id="condition" name="condition" required>
            <option value="">Select condition</option>
            <option value="Like New">Like New</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
          </select>
        </div>

        <div>
          <label for="price">Price ($)</label>
          <input type="number" id="price" name="price" min="1" required>
        </div>

        <button type="submit">List My Book</button>
      </form>
    </div>
  </div>

  <!-- SUCCESS POPUP -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup">
      <h2>Listing Submitted</h2>
      <p>Your listing has been successfully submitted!</p>
      <button id="closePopup">OK</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('sellForm');
    const popupOverlay = document.getElementById('popupOverlay');
    const closePopup = document.getElementById('closePopup');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      let sellerId = null;
      const email = localStorage.getItem('loggedInEmail');

      const resp = await fetch(`/api/me?email=${email}`);
      if (resp.ok) {
        const user = await resp.json();
        sellerId = user.id;
      } else {
        alert("Could not get seller ID");
        return;
      }
      const data = new URLSearchParams({
        sellerId: sellerId,
        code: document.getElementById('course').value,
        title: document.getElementById('title').value,
        author: document.getElementById('author').value,
        ISBN: document.getElementById('isbn').value,
        price: document.getElementById('price').value,
        condition: document.getElementById('condition').value
      });

      const response = await fetch('/listings/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: data
      });

      if (response.ok) {
        popupOverlay.style.display = 'flex';
        form.reset();
      } else {
        alert('Error submitting listing. Please try again.');
      }
    });

    closePopup.addEventListener('click', () => {
      popupOverlay.style.display = 'none';
      window.location.href = '/buy';
    });
  </script>
</body>
</html>
